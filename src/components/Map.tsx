import { useRef, useEffect } from "react";
import maplibregl from "maplibre-gl";
import "maplibre-gl/dist/maplibre-gl.css";
import "./root.css";

const lng = -56.3851;
const lat = 48.9793;
const zoom = 6;
const API_KEY = import.meta.env.VITE_API_KEY;

export const Map = () => {
  const mapContainer = useRef(null);
  const map = useRef<maplibregl.Map | null>(null);

  useEffect(() => {
    if (map.current) return;
    if (!mapContainer.current) {
      return;
    }
    map.current = new maplibregl.Map({
      container: mapContainer.current,
      style: `https://api.maptiler.com/maps/outdoor-v2/style.json?key=${API_KEY}`,
      center: [lng, lat],
      zoom: zoom,
    });

    map.current.on("style.load", () => {
      map.current!.addSource("my-source", {
        type: "geojson",
        data: {
          type: "Feature",
          properties: {},
          geometry: {
            type: "LineString",
            coordinates: [
              [-52.917360047, 47.544699985800001],
              [-52.917358035399999, 47.544697974199998],
              [-52.917357029599998, 47.544697974199998],
              [-52.917357029599998, 47.544697974199998],
              [-52.917361052899999, 47.544696968399997],
              [-52.917369015699997, 47.544695962500001],
              [-52.917379074, 47.544692987],
              [-52.917382007599997, 47.544691981100001],
              [-52.917384019300002, 47.5446909753],
              [-52.917387036800001, 47.5446909753],
              [-52.917388042600003, 47.544692987],
              [-52.917385025100003, 47.544695962500001],
              [-52.917379074, 47.544699985800001],
              [-52.917370021499998, 47.544704973100004],
              [-52.917360047, 47.544708996399997],
              [-52.917349066699998, 47.544713983599998],
              [-52.917340014300002, 47.544716959200002],
              [-52.9173340631, 47.5447189709],
              [-52.917328028199996, 47.544720982500003],
              [-52.917323082800003, 47.544723958100001],
              [-52.917316042099998, 47.5447269756],
              [-52.917310007099999, 47.5447309989],
              [-52.917303050100003, 47.544733974499998],
              [-52.917294081500003, 47.544737997799999],
              [-52.917283017400003, 47.544740973400003],
              [-52.917270025400001, 47.544744996699997],
              [-52.917256027599997, 47.544748978100003],
              [-52.917241024, 47.544752959500002],
              [-52.917226020400001, 47.544757988599997],
              [-52.917212022599998, 47.544762975799998],
              [-52.917199030699997, 47.5447669992],
              [-52.917187044599999, 47.544770980599999],
              [-52.917174052599997, 47.5447759678],
              [-52.9171600548, 47.544780996900002],
              [-52.917146057099998, 47.54478699],
              [-52.917130047599997, 47.544792983100002],
              [-52.917113032400003, 47.544799981899999],
              [-52.917098028700003, 47.544808992500002],
              [-52.917085036800003, 47.544817961100001],
              [-52.917074056499999, 47.544825965800001],
              [-52.917066009899997, 47.544831958899998],
              [-52.917059052900001, 47.544836988100002],
              [-52.917052012100001, 47.544841975300002],
              [-52.917045055099997, 47.544848974200001],
              [-52.917037008500003, 47.5448569789],
              [-52.917028039900003, 47.544865989400002],
              [-52.917019071200002, 47.544874958100003],
              [-52.917010018799999, 47.544884974399999],
              [-52.917000044300003, 47.544893985],
              [-52.916991075699997, 47.544903959499997],
              [-52.916981017399998, 47.54491297],
              [-52.9169730546, 47.544919968899997],
              [-52.9169660138, 47.544926967800002],
              [-52.916959056800003, 47.544932960799997],
              [-52.916954027700001, 47.544938995800003],
              [-52.9169490823, 47.544944988899999],
              [-52.916945059, 47.544952993599999],
              [-52.9169420415, 47.544961962199999],
              [-52.916940029899997, 47.544972984399998],
              [-52.9169380182, 47.544983964700002],
              [-52.916937012399998, 47.544994986900001],
              [-52.916936006599997, 47.545003997499997],
              [-52.916936006599997, 47.545012966100003],
              [-52.916936006599997, 47.545021976699999],
              [-52.916935000700001, 47.545030987200001],
              [-52.916933072900001, 47.545040961700003],
              [-52.916930055400002, 47.545050978],
              [-52.916927037900003, 47.545061958300003],
              [-52.916926032100001, 47.545071974700001],
              [-52.9169250263, 47.5450829969],
              [-52.9169250263, 47.545094983],
              [-52.916924020400003, 47.545105963300003],
              [-52.916924020400003, 47.545117991399998],
              [-52.916923014600002, 47.545127965799999],
              [-52.916921003, 47.545137982200004],
              [-52.916919075099997, 47.545147998600001],
              [-52.916917063500001, 47.545157973],
              [-52.916915051799997, 47.545167989399999],
              [-52.916912034299997, 47.545178969699997],
              [-52.916909016799998, 47.545190997699997],
              [-52.916906083199997, 47.545203989699999],
              [-52.916903065699998, 47.545216981599999],
              [-52.916901054, 47.545229973600001],
              [-52.916901054, 47.5452419597],
              [-52.916903065699998, 47.545253987700001],
              [-52.916905077300001, 47.545264968],
              [-52.916906083199997, 47.545275990199997],
              [-52.916906083199997, 47.545284958899998],
              [-52.916904071499999, 47.545294975200001],
              [-52.916904071499999, 47.5453059974],
              [-52.916903065699998, 47.545316977699997],
              [-52.916903065699998, 47.545326994100002],
              [-52.916902059900004, 47.545335962700001],
              [-52.916901054, 47.5453469849],
              [-52.916899042399997, 47.545359976900002],
              [-52.916898036500001, 47.545372968800002],
              [-52.9168970307, 47.545385960799997],
              [-52.916898036500001, 47.545398994700001],
              [-52.916898036500001, 47.5454109808],
              [-52.916899042399997, 47.545422966899999],
              [-52.916902059900004, 47.545433989099998],
              [-52.916904071499999, 47.545445975200003],
              [-52.916908011, 47.545458967199998],
              [-52.916913040099999, 47.545474976599998],
              [-52.916918069300003, 47.545490986],
              [-52.9169220088, 47.545505989699997],
              [-52.9169250263, 47.545519987399999],
              [-52.916926032100001, 47.545532979400001],
              [-52.916926032100001, 47.545545971300001],
              [-52.916923014600002, 47.545558963300003],
              [-52.916920080899999, 47.545574972700003],
              [-52.916916057599998, 47.545590982199997],
              [-52.916913040099999, 47.545605985800002],
              [-52.916911028500003, 47.545621995200001],
              [-52.916909016799998, 47.545637962699999],
              [-52.916906083199997, 47.545652966299997],
              [-52.916903065699998, 47.545667969900002],
              [-52.916899042399997, 47.5456829735],
              [-52.916893007399999, 47.545696971300003],
              [-52.916889067900001, 47.545711974900001],
              [-52.916887056199997, 47.545726978499999],
              [-52.916886050400002, 47.545741982099997],
              [-52.916884038799999, 47.545756985700002],
              [-52.9168810213, 47.545770983499999],
              [-52.916876076, 47.545783975500001],
              [-52.916872052599999, 47.545797973200003],
              [-52.916870041, 47.545811971],
            ],
          },
        },
      });

      map.current!.addLayer({
        id: "line-layer",
        type: "line",
        source: "my-source",
        paint: {
          "line-width": 2,
          "line-color": "#FF0000",
        },
      });
    });
  });

  return (
    <div className="map-wrap">
      <div ref={mapContainer} className="map" />
    </div>
  );
};
